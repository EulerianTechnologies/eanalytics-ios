# Tagging plan for iOS

## Webview app tracking

About the navigation in a //webview// type of app on iOS (html/js standard website), our internal ID must be provided once the URL opens in order to guarantee the tracking.
To retrieve this value, the technical support of the client must use the following function in our SDK:

  * iOS - Swift:
```xml
let euidl = EAnalytics.euidl
```

  * iOS - ObjectiveC:
```xml
NSString *euidl = [EAnalytics euidl];
```

Once the value is in the parameter **ea-euidl-bypass**, the cookies system is modified in order to use the euidl from the app.

**Example:**

```xml
http://www.vpg.fr/ios-landing-webview?ea-euidl-bypass=$euidl_de_l_app
```

If the ea.js detects a parameter, it will automatically use it and store it during the entire session in order to stop the website from sending it again every time the user visits the page.\\
Once this parameter is passed, the tracking of an IOS app in a webview context is the same as for a classic website.

The documentation available [here] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:general) contains all the information to implement our tags in the JavaScript.

## Native app tracking

In the case of a native app, our SDK must be added to the code of the app in order to integrate the following marker:

```xml
let genericTag = EAProperties(path: "|univers|rubrique|page")
genericTag.setEulerianWithUid("5434742")
genericTag.setEulerianWithEmail("test@test.fr")
genericTag.setEulerianWithProfile("visitor")
genericTag.setEulerianWithPageGroup("pagegroup")
genericTag.setEulerianWithValue("mensuel", forKey: "abonnement")
EAnalytics.track(genericTag)
```

Our **SDK** has been designed to help its integration by offering an easy structure and a detailed documentation.

The parameters and possibilities are the exact same as for our tag collector. Therefore, you will be able to follow the different navigation routes and to compare them to your classic website, integrating the same variables.

The calls generated by these tags are very similar to the calls generated by the classic collectors, and they have been conceived to be as light as possible so they do not disturb the functioning of the app.

Some parameters of our collector are specific to a mobile app tracking. To know more about this, you can check [this documentation] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

Note: Also, our SDK is able to gather an unlimited number of offline interactions and to send them when the user is online.  This process allows us to keep tracking of the user even if they are using the app offline. The navigation is registered and reassigned a posteriori through the parameter ereplay-time.


### Traffic assignation rule

In a classic website, out system identifies and assigns the traffic according to the calling **URL**. However, in the case of an app we do not have access to this information.

Therefore, to define the traffic attribution rule, we will take into account the tracking subdomain used and passed as a parameter **init** on the Eulerian Analytics page:

```xml
EAnalytics.logDebug(true)
EAnalytics.initialize(DOMAINE_DE_TRACKING)
```

Note: This also means that if you use the same tracking subdomain for several apps, they will have to be differentiated by adding the parameter [from] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list) in the markers. This will happen automatically in a hybrid app which shares some pages with your website.

It is also important to know that the absence of a URL means also the absence of the name page by default. The parameter [path] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list) is not optional but __obligatory__ for the tracking of an app.

The traffic generated by your app can be tracked and checked in Eulerianâ€™s website, or be combined with the traffic from a different website. As shown before, if your app changed to webview mode, it will be obligatory for some pages to add the parameter [from] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list) so the traffic is properly redirected to our system. 

## Downloads and updates 

Associated parameters: 
  * **ea-appname**: NOM_APPLICATION , it is the name of the app. It must not change
  * **ea-appversion**: VERSION_APPLICATION, it is the version of the app
  * **ea-appinstalled**: 1, This parameter indicates that no new installation is counted for this call.
It is used to manage the initialization of users who already have the application before the integration of Eulerian.
This parameter can be supplied permanently, in parallel with appversion and appname, as long as the application considers that it has already been launched previously on this device/user.

The presence of the parameter **ea-appname** triggers a treatment of the system. 

The system will feed the metric **download** if:
  * The user has never been exposed to the value of the parameter **ea-appname** upon launching the app and the parameter **ea-appinstalled** is not present in the call

The system will feed the metric **update** if:
  * The user has already been exposed to the parameter **ea-appname** and its value is identical to the parameter in the last launch of the app. However, the value of the parameter **ea-appversion** is different.

![download_upgrade.png](https://bitbucket.org/repo/kA6LdM/images/3930826066-download_upgrade.png)

# List of pages #

  * Generic page
  * Product page
  * Category page
  * Search engine page
  * Error page
  * Cost estimate page
  * Cart page
  * Order page

# Generic page

The marker below is generic and must be implemented in every page of the site except the product sheet, order, cost estimate and initiated cart ones. This includes particularly the homepage and the pages of the conversion tunnel between the cart and the order confirmation.

It allows you to include all the site-centric traffic, the viewed pages and the visits, as well as the origin through natural channels such as direct access, natural indexing or referents.

We manage all the actions to be implemented. Like this, you do not need to change de code of your site to benefit from supplementary functionalities.

You may add the parameters below to the generic format or to the collector markers described in this documentation in order to get more interesting reports.

## List of parameters

  * __**path:**__ (Obligatory) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (Optional) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

The object **EAProperties** is the category containing all the internal or modifiable parameters of our Tag collector. 

To add a new parameter, use the method **setEulerian(CLE, "VALEUR")** or **setEulerian("VALEUR", forKey: "CLE")** if you want a customized parameter.

__**Example .swift:**__

```xml
let genericTag = EAProperties(path: String!)
genericTag.setEulerianWithPageGroup(value: String!)
genericTag.setEulerianWithUid(value: String!)
genericTag.setEulerianWithEmail(value: String!)
genericTag.setEulerianWithProfile(value: String!)
EAnalytics.track(genericTag)
```

__**With values:**__

```xml
let genericTag = EAProperties(path: "generic-page")
genericTag.setEulerianWithPageGroup("my-pagegroup")
genericTag.setEulerianWithUid("123asd")
genericTag.setEulerianWithEmail("test@test.fr")
genericTag.setEulerianWithProfile("visitor")
EAnalytics.track(genericTag)
```

# Product page

This marker allows you to retrieve the viewed pages and the visits to the products in the catalog. It feeds the reports available in the following address:

  * Site-centric > Products > **Product Acquisitions & Performance**

You can also pass one or several product categories.

**Note: Every marker containing only one product reference without the parameters __scart__ __estimate__ __ref__ and __amount__ will be considered a product page.**

In plain language, a collector marker containing one of the parameters above or several product references will not be considered by our system as a marker of a product page.


## List of parameters

  * __**path:**__ (NOM_PAGE) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (UID) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdref:**__ (ID_PRODUIT) This parameter must be fulfilled with the references of the product checked by the user. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdname:**__ (NOM_PRODUIT) You can give a product reference a more legible name to make your reports easier. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdparam-xxxxx :**__ (VALEUR_PARAM, NOM_PARAM) This parameter allows you to associate a category to a product reference. You must precise the name of the category after the prefix **prdparam-**. Examples: prdparam-universe, prdparam-size, etc. You can add as many categories as you want. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

The object **EAProducts** is the category dedicated to the tracking of product pages.

The product must be created via the object **EAOProduct** which takes its reference in the obligatory parameters.
Every object **EAOProduct** may be completed with an independent object **Params** to associate one or more parameters to it.
Once the **EAOProduct** has been started and completed with the desired parameters, you must integrate the object EAProducts via the method **setEulerian()**.


__**Example:**__

```xml
//create object product
let product1 = EAOProduct(ref: String)
product1.setEulerianWithName(value: String)
product1.setEulerianWithGroup(value: String)

//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue(value: String!, forKey: String!)
param1.setEulerianWithStringValue(value: String!, forKey: String!)

//link param1 to product1
product1.setEulerianWith(params: param1)
       
//product page
let productPage = EAProducts(path: String!)
productPage.setEulerianWithPageGroup(value: String!)
productPage.setEulerianWithUid(value: String!)
productPage.setEulerianWithEmail(value: String!)
productPage.setEulerianWithProfile(value: String!)

//link product1 to the product page
productPage.setEulerianWith(eaoproducts: Any!)
EAnalytics.track(productPage)
```

__**With values:**__

```xml
//create object product
let product1 = EAOProduct(ref: "PH774356")
product1.setEulerianWithName("T-shirt")
product1.setEulerianWithGroup("product-group")

//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue("clothes", forKey: "category")
param1.setEulerianWithStringValue("sportswear", forKey: "sub-category")

//link param1 to product1
product1.setEulerianWith(param1)
       
//product page
let productPage = EAProducts(path: "product-page")
productPage.setEulerianWithPageGroup("my-pagegroup")
productPage.setEulerianWithUid("123asd")
productPage.setEulerianWithEmail("test@test.fr")
productPage.setEulerianWithProfile("looker")

//link product1 to the product page
productPage.setEulerianWith(product1)
EAnalytics.track(productPage)
```

# Category page

This marker allows you to send your partners the first 3 product references in the results page to optimize the retargeting of users in your site.

Its use is limited to our product Eulerian Tag Master, and it does not affect the acquisition&performance report in Eulerianâ€™s DDP.

**Note: Every marker containing several product references without the parameters __scart__ __estimate__ __ref__ and __amount__ will be considered a result page.**

In case your results page only contains one product reference and therefore only the parameter **prdref**, the market will be considered as a product page and not a result page.

## List of parameters

  * __**prdref:**__ (ID_PRODUIT) This parameter must be fulfilled with the references of the product checked by the user. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**path:**__ (NOM_PAGE) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (UID) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

The object **EAProducts** is also used for the tracking of result pages.

Every product must be created via the object **EAOProduct** which takes its reference in the obligatory parameters.

__**Example:**__

```xml
let product1 = EAOProduct(ref: String)
let product2 = EAOProduct(ref: String)
let product3 = EAOProduct(ref: String)
 
let categoryPage = EAProducts(path: String!)
categoryPage.setEulerianWithPageGroup(value: String!)
categoryPage.setEulerianWithUid(value: String!)
categoryPage.setEulerianWithEmail(value: String!)
categoryPage.setEulerianWith(product1)
categoryPage.setEulerianWith(product2)
categoryPage.setEulerianWith(product3)

EAnalytics.track(categoryPage)
```

__**With values:**__

```xml
let product1 = EAOProduct(ref: "CH32452")
let product2 = EAOProduct(ref: "C654322")
let product3 = EAOProduct(ref: "V643536")

let categoryPage = EAProducts(path: "Category-page")
categoryPage.setEulerianWithPageGroup("my-pagegroup")
categoryPage.setEulerianWithUid("123asd")
categoryPage.setEulerianWithEmail("test@test.fr")
categoryPage.setEulerianWith(product1)
categoryPage.setEulerianWith(product2)
categoryPage.setEulerianWith(product3)

EAnalytics.track(categoryPage)
```

# Internal search page

This marker allows you to include in your interface queries made by users as well as an unlimited number of additional parameters. All the information is compared to the sales and the acquisition channels activated during the session.

**Note: Every marker containing the parameter __isearchengine__ will be considered a search engine page.**

The marker of the search engine is not exclusive. If you add a product reference with the parameter **prdref** for instance, the marker will be considered a product page.

## Liste des paramÃ¨tres

  * __**path:**__ (NOM_PAGE) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (UID) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**isearchengine:**__ (NOM_MOTEUR_INTERNE) This parameter will name the internal search engine and allows you to differentiate it from other search fields, in case you have more than one in your site. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**isearchresults:**__ (NOMBRE_DE_RESULTATS) This parameter must contain the number of search results generated by the user. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**isearchkey:**__ (CLE_DU_PARAMETRE_RECHERCHE) This parameter must contain the key of the additional fields you want to integrate in your internal search marker. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**isearchdata :**__ (VALEUR_DU_PARAMETRE_RECHERCHE) This parameter must contain the value of the isearchkey field named above. Every supplementary search field requires we add the parameters isearchkey and isearchdata. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

The object **EASearch** is the category dedicated to the tracking of the internal search engine.

Create an object**Params** and use the method **addParam** for every **isearchkey** and **isearchdata** parameter.

__**Example:**__

```xml
let params = EAOParams()
params.setEulerianWithStringValue(value: String!, forKey: String!)
params.setEulerianWithStringValue(value: String!, forKey: String!)
params.setEulerianWithStringValue(value: String!, forKey: String!)
 
let search = EASearch(path: String!, withName: String!)
searchPage.setEulerianWithPageGroup(value: String!)
searchPage.setEulerianWithUid(value: String!)
searchPage.setEulerianWithEmail(value: String!)
searchPage.setEulerianWithResults(Int32!)
searchPage.setEulerianWith(EAOParams!)
EAnalytics.track(searchPage)
```

__**With values:**__

```xml
let params = EAOParams()
params.setEulerianWithStringValue("t-shirt", forKey: "my-search-bar")
params.setEulerianWithStringValue("100.00", forKey:"prix_min")
params.setEulerianWithStringValue("400.00", forKey:"prix_max")

let searchPage = EASearch(path: "search-engine-page", name: "name-internal-search-engine")
searchPage.setEulerianWithPageGroup("my-pagegroup")
searchPage.setEulerianWithUid("123asd")
searchPage.setEulerianWithEmail("test@test.fr")
searchPage.setEulerianWithResults(20)
searchPage.setEulerianWith(params)
EAnalytics.track(searchPage)
```

# 404 error page

The **error** marker indicated that the application has generated a 404 error. It feeds your reports, available in the following address:

  * Site-centric > Audience analysis > Per page > **Error page**

This tag allows you to retrieve all the URL which generated a 404 page and allow you to make the necessary corrections to redirect the traffic.

You may use it to be notified in case of recurring problems in a particular step of your conversion tunnel.


## List of parameters

  * __**error:**__ (Obligatory) This parameter is always **1** and can be added to all types of markers. Its presence in the marker will count up one viewed page in the report previously mentioned. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**path:**__ (Obligatory) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

Use the method set with the key error to flag the error page.

__**Example:**__

```xml
let errorTag = EAProperties(path: "error-page")
errorTag.setEulerianWithValue(1, forKey: "error")
EAnalytics.track(errorTag)
```

# Cost estimate page

This marker count up the cost estimates and the information related to this type of conversion: 
  * The products in it. 
  * The type of estimate.
  * The total sum
  * Contextual information 

Every new estimate is provided with the details of all the channels and the navigation history that led to its generation. 

**Note: Duplicates will be removed according to the references provided by the marker.**

If you use twice the same reference for the same two estimates, the second call will be ignored in virtue of the principle of uniqueness conversion.\\

Eulerian Analytics allows you to cancel or validate estimates to measure the real performance of your campaigns in time. 

**Note: Every marker containing the parameters __ref__ and __estimate__ will be considered a cost estimate page.**

## List of parameters

  * __**path:**__ (NOM_PAGE) ) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (UID) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**ref:**__ (REFERENCE_DEVIS) This is a unique reference of the estimate allowing you to identify it and find it in our system. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**amount:**__ (MONTANT_DEVIS) This parameter must contain the total sum with taxes. Decimals will be separated by a point. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**type:**__ (TYPE_DE_DEVIS) This parameter allows you categorize the cost estimate according to you reference document. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdref:**__ (ID_PRODUIT) This parameter must be fulfilled with the references of the product checked by the user. To know more about this you may check [this article] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdamount:**__ (MONTANT_PRODUIT) This parameter allows you to specify the total of each product in the cost estimate. To know more about this you may check [this article] (https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdquantity:**__ (QUANTITE_PRODUIT) This parameter allows you to specify the quantity of each product in the cost estimate. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

__**Example:**__

## Implementation

The object **EAEstimate** is the category dedicated to the tracking of cost estimation pages.

An estimation can contain one or several products. Every product must be created via the object **EAOProduct** which takes its reference in the obligatory parameters.
Every object **EAOProduct** must be completed with the desired parameters before being integrated in the object **EAEstimate** via the method setEulerian. 

**Example:**

```xml
let product1 = EAOProduct(ref: String!)
let product2 = EAOProduct(ref: String!)
         
let estimatePage = EAEstimate(path: String!, withRef: String!)
estimatePage.setEulerianWithPageGroup(value: String!)
estimatePage.setEulerianWithUid(value: String!)
estimatePage.setEulerianWithEmail(value: String!)
estimatePage.setEulerianWithType(value: String!)
estimatePage.setEulerianWithAmount(value: Double!)
estimatePage.setEulerianWithCurrency(value: String!)

//custom parameter
estimatePage.setEulerianWithValue(value: Any!, forKey: String!)
estimatePage.setEulerianWithValue(value: Any!, forKey: String!)

estimatePage.addEulerian(product: EAOProduct!, amount: Double, quantity: Int32)
estimatePage.addEulerian(product: EAOProduct!, amount: Double, quantity: Int32)
EAnalytics.track(estimatePage)
```

**With values:**

```xml
let product1 = EAOProduct(ref: "product1")
let product2 = EAOProduct(ref: "product2")
         
let estimatePage = EAEstimate(path: "page-devis", withRef: "ref-devis-123")
estimatePage.setEulerianWithPageGroup("my-pagegroup")
estimatePage.setEulerianWithUid("123asd")
estimatePage.setEulerianWithEmail("test@test.fr")
estimatePage.setEulerianWithType("my-estimate-type")
estimatePage.setEulerianWithAmount(12.34)
estimatePage.setEulerianWithCurrency("EUR")

//custom parameter
estimatePage.setEulerianWithValue("VALUE1", forKey: "MY_KEY1")
estimatePage.setEulerianWithValue("VALUE2", forKey: "MY_KEY2")

estimatePage.addEulerian(product1, amount: 11.34, quantity: 1)
estimatePage.addEulerian(product2, amount: 1, quantity: 1)
EAnalytics.track(estimatePage)
```

# Cart page

This marker counts up the initiated carts and allows you to calculate the conversion and quitting rate in relation to the sale marker.

You may also move products and categories associated to the visitorâ€™s cart by specifying the respective sums and quantities. These parameters allow you to feed your product reports available in the following address:

  * Site-centric > Products > **Product Acquisitions & Performance**

The cart lifespan is 30 minutes, according to [[fr:glossary|our definition]].

## List of parameters

  * __**scartcumul :**__ (Obligatory) The value of this parameter shows the way to count up the products in the cart. When it equals 0, our system considers the products passed by the marker as part of the cart. When it equals 1, le products passed by the marker will be added to every successive call. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**path:**__ (Obligatory) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (Optional) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdref:**__ (Obligatory) This parameter must be fulfilled with the references of the product checked by the user. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdamount:**__ (Obligatory) This parameter allows you to specify the total of each product in the cost estimate. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdquantity:**__ (Obligatory) This parameter allows you to specify the quantity of each product in the cost estimate. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation

The object **EACart** is the category dedicated to the tracking of the initiated cart pages.

A cart can contain one or several products. Every product must be created via the object **EAOProduct** which takes its reference in the obligatory parameters.
Every object **EAOProduct** must be completed with the desired parameters before being integrated in the object **EACart** via the method addEulerian. 

__**Example:**__

```xml
let product1 = EAOProduct(ref: String!)
let product2 = EAOProduct(ref: String!)
        
//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue(value: String!, forKey: String!)
let param2 = EAOParams()
param2.setEulerianWithStringValue(value: String!, forKey: String!)
       
//link parameters to products
product1.setEulerianWith(value: EAOParams!)
product2.setEulerianWith(value: EAOParams!)

//tag
let cartPage = EACart(path: String!#>)
cartPage.setEulerianWithPageGroup(value: String!)

//user information
cartPage.setEulerianWithUid(value: String!)
cartPage.setEulerianWithEmail(value: String!)
cartPage.setEulerianWithProfile(value: String!)

//set scartcumul
cartPage.setEulerianWithCumul(value: Bool!)

//custom parameter
cartPage.setEulerianWithValue(value: Any!, forKey: String!)
cartPage.setEulerianWithValue(value: Any!, forKey: String!)

//add products tu cart
cartPage.addEulerian(product: EAOProduct!, amount: Double!, quantity: Int32)
cartPage.addEulerian(product: EAOProduct!, amount: Double!, quantity: Int32)
EAnalytics.track(cartPage)
```

__**With values:**__

```xml
let product1 = EAOProduct(ref: "ref_product_1")
let product2 = EAOProduct(ref: "ref_product_2")
        
//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue("red", forKey: "color")
let param2 = EAOParams()
param2.setEulerianWithStringValue("large", forKey: "dimension")
        
//link parameters to products
product1.setEulerianWith(product1)
product2.setEulerianWith(product2)


//tag
let cartPage = EACart(path: "cart-page")
cartPage.setEulerianWithPageGroup("my-pagegroup")

//user information
cartPage.setEulerianWithUid("123asd")
cartPage.setEulerianWithEmail("test@test.fr")
cartPage.setEulerianWithProfile("shopper")

//set scartcumul
cartPage.setEulerianWithCumul(false)

//custom parameter
cartPage.setEulerianWithValue("VALUE1", forKey: "MY_KEY1")
cartPage.setEulerianWithValue("VALUE2", forKey: "MY_KEY2")

//add products tu cart
//repeat for every product
cartPage.addEulerian(product1, amount: 5.5, quantity: 1)
cartPage.addEulerian(product2, amount: 3.2, quantity: 3)
EAnalytics.track(cartPage)
```

# Order page

This marker counts up the conversions and helps estimating the ROI for all your marketing channels. In addition to the total sum of the order, you can include the products, the type of payment, the currency and the type of sale. These priorities enrich the detail level of your reportings and may be exploited in our product. Every new conversion includes all details about the channels and the navigation history. 

**Note: Duplicates will be removed according to the references provided by the marker.**

If you use twice the same reference for the same two estimates, the second call will be ignored in virtue of the principle of unique order.

Eulerian DDP allows you to cancel orders to measure the real performance of your campaigns. We recommend you to implement the order tag as soon as possible in the buying process if the information to set the call is available (reference, sum, type of payment, etc.).

In fact, if the payment platform does not require the user goes back to the site to validate their order, a market after the payment platform will not always be called.

**Note: Beside the order status (pending, valid or invalid), it is not possible to define the content of an order after it is registered. We cannot add or delete a product, but we can modify the total sum of the order.**

**Note: Every marker containing the parameters __ref__ and __amount__ and not containing the parameters __scart__ and __estimate__ will be considered a confirmation page.**


## List of parameters

  * __**path:**__ (NOM_PAGE) This parameter allows you to name the page in order to identify it in the reports. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**uid:**__ (UID) This parameter must be fulfilled with your internal ID when the user is logged in in order to consolidate the history data gathered from different devices. You may also reconcile a click with the download of the app. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**ref:**__ (REFERENCE_VENTE) This is a unique reference of the estimate allowing you to identify it and find it in our system. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**amount:**__ (MONTANT_VENTE) This parameter must contain the total sum with taxes. Decimals will be separated by a point. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**payment:**__ (MOYEN_DE_PAIEMENT) This parameter allows you to include the type of payment used by the buyer. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**type:**__ (TYPE_DE_VENTE) This parameter allows you categorize the cost estimate according to you reference document. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**currency:**__ (DEVISE_DU_MONTANT) This parameter allows you to convert the total indicated in the parameter amount if it is in a different currency than the one used in the interface. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**newcustomer:**__ (0_OU_1) This parameter is used in the order marker to differentiate new buyers from loyal customers. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdref:**__ (ID_PRODUIT) This parameter must be fulfilled with the references of the product checked by the user. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdamount:**__ (MONTANT_PRODUIT) This parameter allows you to specify the total of each product in the cost estimate. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).
  * __**prdquantity:**__ (QUANTITE_PRODUIT) This parameter allows you to specify the quantity of each product in the cost estimate. To know more about this you may check [this article](https://eulerian.wiki/doku.php?id=en:collect:technical_implementation:parameters_list).

## Implementation
The object **EAOrder** is the category dedicated to the tracking of orders.

An order tag can contain one or several products. Every product must be created via the object **EAOProduct** which takes its reference in the obligatory parameters.
Every object **EAOProduct** must be completed with the desired parameters before being integrated in the object **EAOrder** via the method **addProduct**


__**Example:**__

```xml
let product1 = EAOProduct(ref: String!)
let product2 = EAOProduct(ref: String!)
        
//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue(value: String!, forKey: String!)
let param2 = EAOParams()
param2.setEulerianWithStringValue(value: String!, forKey: String!)
       
//link parameters to products
product1.setEulerianWith(value: EAOParams!)
product2.setEulerianWith(value: EAOParams!)

//tag 
let orderPage = EAOrder(path: String!, withRef: String!)
orderPage.setEulerianWithPageGroup(value: String!)
        
//user information
orderPage.setEulerianWithUid(value: String!)
orderPage.setEulerianWithEmail(value: String!)
orderPage.setEulerianWithProfile(value: String!)
orderPage.setEulerianWithNewCustomer(value: Bool!)
        
//order page parameters
orderPage.setEulerianWithAmount(value: Double!)
orderPage.setEulerianWithType(value: String!)
orderPage.setEulerianWithPayment(value: String!)
orderPage.setEulerianWithCurrency(value: String!)

//custom parameter
orderPage.setEulerianWithValue(value: Any!, forKey: String!)
orderPage.setEulerianWithValue(value: Any!, forKey: String!)
        
//repeat for every product
orderPage.addEulerian(product: EAOProduct!, amount: Double!, quantity: Int32)
orderPage.addEulerian(product: EAOProduct!, amount: Double!, quantity: Int32)

//trigger
EAnalytics.track(orderPage)
```

__**With values:**__

```xml
let product1 = EAOProduct(ref: "ref_product_1")
let product2 = EAOProduct(ref: "ref_product_2")
        
//product parameter
let param1 = EAOParams()
param1.setEulerianWithStringValue("red", forKey: "color")
let param2 = EAOParams()
param2.setEulerianWithStringValue("large", forKey: "dimension")
        
//link parameters to products
product1.setEulerianWith(param1)
product2.setEulerianWith(param2)
         
let orderPage = EAOrder(path: "sale-page", withRef: "random-ref")
orderPage.setEulerianWithPageGroup("my-pagegroup")
        
//user information
orderPage.setEulerianWithUid("123345")
orderPage.setEulerianWithEmail("test@test.fr")
orderPage.setEulerianWithProfile("buyer")
orderPage.setEulerianWithNewCustomer(true)
        
//order page parameters
orderPage.setEulerianWithAmount(10.50)
orderPage.setEulerianWithType("ecommerce")
orderPage.setEulerianWithPayment("CB")
orderPage.setEulerianWithCurrency("EUR")
        
//CRM parameter
orderPage.setEulerianWithValue("Andrea", forKey: "name")
orderPage.setEulerianWithValue("Rome", forKey: "city")

//custom parameter
orderPage.setEulerianWithValue("italy", forKey: "delivery")
orderPage.setEulerianWithValue("my-promocode", forKey: "promo-code")
        
//link product tu sale
//repeat for every product
orderPage.addEulerian(product1, amount: 2, quantity: 2)
orderPage.addEulerian(product2, amount: 6.50, quantity: 1)
        
//trigger
EAnalytics.track(orderPage)
```


# Context Flag (CFLAG)

The EAOSiteCentricCFlag object is the class dedicated to the context flag.

You can create one or more context flags via the EAOSiteCentricCFlag object and with the function "**setEulerianWithValue("VALUE", forKey: "CLE")**" which takes the value (one or more) and the key of the context flag. The maximum number of possible values is 10.

__**Exemple:**__

```xml

let cFlag = EAOSiteCentricCFlag()
cFlag.setEulerianWithValues(["val1", "val2","val3"], forKey: "key1")
cFlag.setEulerianWithValues(["valA"], forKey: "keyA")

let genericTag = EAProperties(path: "NOM_PAGE")
genericPage.setEulerianWith(cFlag)
EAnalytics.track(genericTag)
```
